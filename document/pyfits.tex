\chapter{PyFITS and FITS Files}
\label{ch:pyfits}
PyFITS provides an interface to FITS formatted files under the Python
scripting language.  PyFITS is a development project of the Science
Software Branch at the Space Telescope Science Institute.  See the 
\href{http://stsdas.stsci.edu/download/wikidocs/The_PyFITS_Handbook.pdf}{PyFITS Handbook}
listed in Chapter~\ref{ch:links} for documentation and
examples.

PyFITS data structures are a subclass of NumPy arrays, which means
that they can use NumPy arrays' methods and attributes.
 
\section{Opening, Reading, and Closing a FITS File }
As an example, we will use data from the \emph{NICMOS} instrument located here:  \\
/grp/jwst/wit/miri/randers/PythonTraining/n9vf01hfq\_ima.fits \\ 
Please copy this file to your working directory. 

Below we show an example of opening a FITS file, getting
the data and the header, closing the file, printing out the shape of
the data using {\sf \small numpy.shape}, printing out header values,
and finally making changes to the data.

\begin{alltt}
\pytab infile = 'n9vf01hfq_ima.fits'
\pytab import pyfits 
\pytab pyfits.info(infile)
\pytab data = pyfits.getdata(infile,1) 
\pytab hdr = pyfits.getheader(infile,0) 
# get 1st extension's data and header 
\pytab data, hdr = pyfits.getdata(infile, 1, header=True)
\pytab data.shape
\pytab print hdr 
\pytab hdr['DARKCORR'] 
\pytab hdr['DARKCORR'] = 'PERFORM'
\pytab hdr['DARKCORR']
\pytab print data[-2:]  #print the last two lines.
\pytab data[-1:][0][0] = 'SMN'
\pytab print data[-1]
\end{alltt}

Notice that $hdr$ behaves like a dictionary.  We did some
bad things to this file, but let's save it anyway to a new file.

\begin{alltt}
\pytab outfits = 'mybad.fits'
\pytab pyfits.writeto(outfits, data, hdr)
\pytab print 'Saved FITS file to: ',outfits
\end{alltt}

If you already have a file names 'mybad.fits' and would like to
modify it, we can do the following:

\texttt{\pytab pyfits.update('mybad.fits',data,1)}

\section{{\sf pyfits.getval()} and {\sf pyfits.setval()} functions}

If you are familiar with IRAF, you are probably familiar with IRAF's
{\sf\small hedit} function, which allows you to add, delete, and
modify keywords in a FITS header.  

First, lets take a look of our example file's header using {\sf\small
  imheader} in IRAF.  In IRAF navigate to the folder where your
n9vf01hfq\_ima.fits file is located, and try the following:

\begin{alltt}
ecl> images
ecl> imheader n9vf01hfq_ima.fits[0] l+ | page 
\end{alltt}

We see that there is a 'NSLEWCON' keyword, and it is set to 'Clear.'
Using {\sf\small hedit} we can change the 'NSLEWCON' keyword from
'Clear' to 'Set' as shown here:

\begin{alltt}
ecl> hedit n9vf01hfq_ima.fits NSLEWCON 'Set'  \textbackslash
\ldots     verify=no update=yes
\end{alltt}

In the above example we made sure the 'update' parameter was set to
'yes.'  We can check that our edit was successful by using  {\sf\small
  imheader} again.  

Without using IRAF, there is a simple way to do this in PyFITS using
{\sf\small pyfits.getval()} and {\sf\small pyfits.setval()}, shown in
the example below.

\begin{alltt}
\pytab import pyfits 
\pytab infile = 'n9vf01hfq_ima.fits' 
\pytab key = 'NSLEWCON'
\pytab pyfits.getval(infile,key, 0)
\pytab pyfits.setval(infile,key,value='Clear', ext=0)
\end{alltt}

Now our FITS file is back to its 'initial' state.  No harm done.
    
