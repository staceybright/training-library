

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Up-the-ramp Sampling with calwf3 &mdash; RIA Training Library</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Technical Staff Training
          

          
          </a>

          
            
            
              <div class="version">
                published 2018-7-30
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../computer_setup.html">Setting Up Your Computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../version_control.html">Version Control with git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archives.html">Using MAST (a.k.a. the Archive)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Python for Scientific Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apt_etc/index.html">The Astronomer’s Proposal Tool and the Exposure Time Calculator for HST and JWST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../photometry.html">Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drizzle.html">Using DrizzlePac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spectroscopy/index.html">Basic Spectroscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pysynphot.html">Using PySynphot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pysynphot.html#HST-Conclusion"><em>HST</em> Conclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pysynphot.html#Using-PySynphot-for-JWST-and-Advanced-Topics">Using <code class="docutils literal notranslate"><span class="pre">PySynphot</span></code> for <em>JWST</em> and Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pysynphot.html#Conclusion">Conclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../editing_these_documents.html">Editing These Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tricks.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trainees.html">Past Trainees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boneyard.html">Retired topics</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Technical Staff Training</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Up-the-ramp Sampling with calwf3</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/downloads/notebooks/up_the_ramp_calwf3.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="Up-the-ramp-Sampling-with-calwf3">
<h1>Up-the-ramp Sampling with calwf3<a class="headerlink" href="#Up-the-ramp-Sampling-with-calwf3" title="Permalink to this headline">¶</a></h1>
<p><em>Author: Massimo Robberto</em></p>
<p><em>Contributors: Bryan Hilbert, Megan Sosey, Joseph Long</em></p>
<p>This training is meant to familiarize you with the behavior of IR
detectors and the basic corrections that are needed for scientific
observations. In this training, you will have an introduction to the
pipeline reductions of the HST instrument WFC3 also known as WF3. Helped
by Bryan Hilbert and Megan Sosey, I (Massimo Robberto) have put together
this IPython notebook to “x-ray” the 11 steps performed by CALWF3-IR to
extract a count-rate image from a raw ramp. (For comments, suggestions
and to share improved versions, e-mail <a class="reference external" href="mailto:robberto&#37;&#52;&#48;stsci&#46;edu">robberto<span>&#64;</span>stsci<span>&#46;</span>edu</a>.)</p>
<p>This notebook uses example data found in
<code class="docutils literal notranslate"><span class="pre">/grp/hst/riab/training/up_the_ramp_sampling/WFC3_tutorial</span></code>, and
expects these files to be present in your current directory. (Make sure
to copy them over if you have not already.) The notebook runs on an
arbitrary image with the associated calibration files; any other image +
calibration file downloaded from the archive should work.</p>
<p>Run through the code cells in the rest of this document, then try the
exercise in the box immediately below.</p>
<div class="admonition note">
<strong>Exercise:</strong> Plot counts vs.&nbsp;total integration time from the IMA file
for the pixel in the tutorial. Describe the behavior of the signal. How
is the pixel used for the final slope calculation?</div>
<div class="admonition note">
<strong>Tip:</strong> Use header keyword ‘SAMPTIME’ from each ‘SCI’ extension of the
IMA file. Make sure to check the ‘BUNIT’ keyword.</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
<div class="section" id="Load-and-check-the-raw-data-file">
<h2>Load and check the raw data file<a class="headerlink" href="#Load-and-check-the-raw-data-file" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">filebase</span> <span class="o">=</span> <span class="s1">&#39;icol26k3q&#39;</span>
<span class="n">file_raw</span> <span class="o">=</span> <span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_raw.fits&#39;</span>
<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_raw</span><span class="p">)</span>
<span class="n">hdulist</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Filename: icol26k3q_raw.fits
No.    Name         Type      Cards   Dimensions   Format
0    PRIMARY     PrimaryHDU     204   ()
1    SCI         ImageHDU        83   (1024, 1024)   int16 (rescales to uint16)
2    ERR         ImageHDU        44   ()
3    DQ          ImageHDU        36   ()
4    SAMP        ImageHDU        30   ()
5    TIME        ImageHDU        30   ()
6    SCI         ImageHDU        83   (1024, 1024)   int16 (rescales to uint16)
7    ERR         ImageHDU        44   ()
8    DQ          ImageHDU        36   ()
9    SAMP        ImageHDU        30   ()
10   TIME        ImageHDU        30   ()
11   SCI         ImageHDU        83   (1024, 1024)   int16 (rescales to uint16)
12   ERR         ImageHDU        44   ()
13   DQ          ImageHDU        36   ()
14   SAMP        ImageHDU        30   ()
15   TIME        ImageHDU        30   ()
16   SCI         ImageHDU        83   (1024, 1024)   int16 (rescales to uint16)
17   ERR         ImageHDU        44   ()
18   DQ          ImageHDU        36   ()
19   SAMP        ImageHDU        30   ()
20   TIME        ImageHDU        30   ()
21   SCI         ImageHDU        83   (1024, 1024)   int16 (rescales to uint16)
22   ERR         ImageHDU        44   ()
23   DQ          ImageHDU        36   ()
24   SAMP        ImageHDU        30   ()
25   TIME        ImageHDU        32   ()
</pre></div></div>
</div>
</div>
<div class="section" id="Unpack-the-datacube">
<h2>Unpack the datacube<a class="headerlink" href="#Unpack-the-datacube" title="Permalink to this headline">¶</a></h2>
<p>In this excercise I care about the counts, the error and the data
quality</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="mi">1024</span><span class="p">))</span>
<span class="n">error</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="mi">1024</span><span class="p">))</span>  <span class="c1">#adding error matrix</span>
<span class="n">dq</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="mi">1024</span><span class="p">))</span>  <span class="c1">#DQ matrix</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Pick-up-a-pixel-to-be-followed-to-the-end">
<h2>Pick up a pixel to be followed to the end<a class="headerlink" href="#Pick-up-a-pixel-to-be-followed-to-the-end" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Good pixels to follow are the weird one, e.g. the those at the peak of a PSF (saturated), CRs, hot pixels etc/</span>
<span class="n">ii</span><span class="o">=</span><span class="mi">441</span><span class="o">+</span><span class="mi">5</span>
<span class="n">jj</span><span class="o">=</span><span class="mi">716</span><span class="o">+</span><span class="mi">5</span>

<span class="c1">#If you pick up a pixel inspecting an image with xv, remember that python (like IDL) starts from 0,0, while xv starts from 1,1</span>
<span class="c1">#There are also the 5 rows/columns of reference pixels, that will be trimmed out at the end, i.e. the final data product</span>
<span class="c1">#is a 1014x1014 image, not a 1024x1024.</span>
<span class="c1">#I enter the coordinates after inspecting the final 1014x1014 image, so I add +5</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#check what we have as baseline</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span>

<span class="c1">#and remember that WFC3 stored the ramp in reverse order last-&gt;first. The first counts are higher than the last.</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 54657.  54631.  54790.  38868.  25537.]
[ nan  nan  nan  nan  nan]
[ nan  nan  nan  nan  nan]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Prepare an array storing the results, step by step, for a final plot</span>
<span class="n">listout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">13</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">13</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">13</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RAW&#39;</span><span class="p">]</span>   <span class="c1">#this is the flag for the original data.</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#setup and cleanp</span>
<span class="n">os</span><span class="o">.</span><span class="n">putenv</span><span class="p">(</span><span class="s2">&quot;iref&quot;</span><span class="p">,</span><span class="s2">&quot;../calfiles/&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="o">+</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="o">+</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="o">+</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="o">+</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">wfc3tools</span> <span class="k">import</span> <span class="n">calwf3</span>
<span class="kn">from</span> <span class="nn">wfc3tools</span> <span class="k">import</span> <span class="n">wf3ir</span>

<span class="k">def</span> <span class="nf">calwf3_run</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run only some of the calwf3 steps.</span>
<span class="sd">    stepdict is a dictionary where the keys are the names of the calwf3 steps,</span>
<span class="sd">    and the values are True or False</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#update the dict if kw isn&#39;t NONE</span>
    <span class="k">if</span> <span class="n">kw</span><span class="p">:</span>
        <span class="n">stepdict</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    <span class="c1"># make a backup copy of the original file</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;cp &quot;</span><span class="o">+</span> <span class="n">file</span><span class="o">+</span><span class="s2">&quot; backup_copy_&quot;</span><span class="o">+</span><span class="n">file</span><span class="p">)</span>

    <span class="c1">#declare which steps are going to be run</span>
    <span class="n">hdulist</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">)</span>

    <span class="c1">#reset all steps to OMIT, then set only those</span>
    <span class="c1">#requested to PERFORM</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;DQICORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OMIT&#39;</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;ZSIGCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OMIT&#39;</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;ZOFFCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OMIT&#39;</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;DARKCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OMIT&#39;</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;BLEVCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OMIT&#39;</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NLINCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OMIT&#39;</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FLATCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OMIT&#39;</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;DRIZCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OMIT&#39;</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PHOTCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OMIT&#39;</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;UNITCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OMIT&#39;</span>
    <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OMIT&#39;</span>


    <span class="k">if</span> <span class="n">stepdict</span><span class="p">[</span><span class="s1">&#39;dqi&#39;</span><span class="p">]:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;DQICORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PERFORM&#39;</span>

    <span class="k">if</span> <span class="n">stepdict</span><span class="p">[</span><span class="s1">&#39;zsig&#39;</span><span class="p">]:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;ZSIGCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PERFORM&#39;</span>

    <span class="k">if</span> <span class="n">stepdict</span><span class="p">[</span><span class="s1">&#39;zoff&#39;</span><span class="p">]:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;ZOFFCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PERFORM&#39;</span>

    <span class="k">if</span> <span class="n">stepdict</span><span class="p">[</span><span class="s1">&#39;dark&#39;</span><span class="p">]:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;DARKCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PERFORM&#39;</span>

    <span class="k">if</span> <span class="n">stepdict</span><span class="p">[</span><span class="s1">&#39;blev&#39;</span><span class="p">]:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;BLEVCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PERFORM&#39;</span>

    <span class="k">if</span> <span class="n">stepdict</span><span class="p">[</span><span class="s1">&#39;nlin&#39;</span><span class="p">]:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NLINCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PERFORM&#39;</span>

    <span class="k">if</span> <span class="n">stepdict</span><span class="p">[</span><span class="s1">&#39;flat&#39;</span><span class="p">]:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FLATCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PERFORM&#39;</span>

    <span class="k">if</span> <span class="n">stepdict</span><span class="p">[</span><span class="s1">&#39;driz&#39;</span><span class="p">]:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;DRIZCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PERFORM&#39;</span>

    <span class="k">if</span> <span class="n">stepdict</span><span class="p">[</span><span class="s1">&#39;phot&#39;</span><span class="p">]:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PHOTCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PERFORM&#39;</span>

    <span class="k">if</span> <span class="n">stepdict</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;UNITCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PERFORM&#39;</span>

    <span class="k">if</span> <span class="n">stepdict</span><span class="p">[</span><span class="s1">&#39;cr&#39;</span><span class="p">]:</span>
        <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRCORR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PERFORM&#39;</span>

    <span class="n">hdulist</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="c1">#run calwf3</span>
    <span class="n">calwf3</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="n">imafile</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;ima.fits&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;calwf3 complete: output saved in </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">imafile</span>)
    <span class="k">return</span> <span class="n">imafile</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The following tasks in the wfc3tools package can be run with TEAL:
  calwf3    pstack    pstat     wf32d     wf3ccd    wf3cte    wf3ir     wf3rej
</pre></div></div>
</div>
</div>
<div class="section" id="Step-1:-DQI-–-IR-Data-Quality-Array-Initialization">
<h2>Step 1: DQI – IR Data Quality Array Initialization<a class="headerlink" href="#Step-1:-DQI-–-IR-Data-Quality-Array-Initialization" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Header Switch: DQICORR</li>
<li>Header Keywords Updated: None</li>
<li>Reference Files: BPIXTAB (<a href="#id1"><span class="problematic" id="id2">*</span></a>_bpx.fits)</li>
</ul>
<p>DQICORR populates the data quality (DQ) array in all IR readouts by
reading a table of known bad pixels for the detector, stored in the ‘Bad
Pixel’ reference table (BPIXTAB). The types of bad pixels that can be
flagged are listed in Table 2.5. The DQ array may already have been
populated with some values to flag pixels that were affected by
telemetry problems during downlink. Other DQ values will only be marked
during further processing (such as cosmic-ray rejection). The reference
file for data quality initialization, BPIXTAB, is selected based on the
value of the DETECTOR keyword only.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># We put the steps in a dictionary, flagging as True those that we want to run.</span>
<span class="n">stepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dqi&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zsig&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;zoff&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;blev&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;nlin&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;driz&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;phot&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;cr&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="c1">#and GO</span>
<span class="n">calwf3_run</span><span class="p">(</span><span class="n">file_raw</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1">#Read and print the results of this first calibration step</span>
<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_ima.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="c1">#</span>
<span class="c1">#store in the summary cubes</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;DQI&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calwf3 complete: output saved in icol26k3q_ima.fits
[ 54657.  54631.  54790.  38868.  25537.]
[ 153.07583618  153.03955078  153.26138306  129.16957092  104.82255554]
[ 0.  0.  0.  0.  0.]
</pre></div></div>
</div>
</div>
<div class="section" id="Step-2:-ZSIG-–-IR-Zero-Read-Signal-Correction">
<h2>Step 2: ZSIG – IR Zero-Read Signal Correction<a class="headerlink" href="#Step-2:-ZSIG-–-IR-Zero-Read-Signal-Correction" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Header Switch: ZSIGCORR</li>
<li>Header Keywords Updated: None</li>
<li>Reference Files: DARKFILE (<a href="#id3"><span class="problematic" id="id4">*</span></a>_drk.fits), NLINFILE (<a href="#id5"><span class="problematic" id="id6">*</span></a>_lin.fits)</li>
</ul>
<p>At the beginning of an IR observation the detector pixels are reset to
the bias level and then read out to record that bias level. An interval
of approximately 2.9 seconds elapses between the time each pixel is
reset and then read. Because the IR channel does not have a shutter,
signal from external sources starts to accumulate during that 2.9 second
interval. When the initial (or ‘zeroth’) read is later subtracted from
subsequent readouts, any signal in the zeroth read will also be
subtracted. Because linearity correction and saturation checking
(described below) both depend on the absolute signal level in a pixel at
the time it was read, the signal in the zeroth read from bright sources
can be large enough to lead to inaccurate linearity corrections, as well
as the failure to detect saturation conditions, in the NLINCORR
calibration step.</p>
<p>The ZSIGCORR step is used to estimate the amount of source signal in the
zeroth read and to supply this estimate to the NLINCORR step for
linearity corrections and saturation checking. ZSIGCORR estimates the
signal in the zeroth read by first measuring the signal in each pixel
between the zeroth and first reads, and then scaling that signal to the
effective exposure time of the zeroth read (nominally 2.9 seconds).
Pixels that have an estimated zeroth read signal greater than 5 times
their estimated uncertainty (noise) value are assumed to contain
detectable signal; those below this threshold are ignored. The estimated
zeroth read signal is then passed, as an in-memory image, to the
NLINCORR step, which accounts for that signal when applying linearity
corrections and saturation checking on the zeroth-read subtracted
images.</p>
<p>Note that this technique will not work well for pixels covered by
targets that are so bright that the signal is already beginning to
saturate in either the zeroth or first readouts, because then it is
difficult to accurately estimate the zeroth-read signal. ZSIGCORR
therefore checks for saturation in the zeroth and first read images and
flags those pixels.</p>
<p>Pixels that are determined to have detectable signal in the zeroth read
are flagged in the DQ arrays of the output ima file with a data quality
value of 2048. The reference files used in this step, DARKFILE and
NLINFILE, are selected from CDBS based on the values of the DETECTOR,
CCDAMP, CCDGAIN, SAMP_SEQ, and SUBTYPE keywords. The DARKFILE file is
used to subtract dark current from the first-minus-zero read difference
image before using it to estimate incoming signal levels and the
NLINFILE is used to perform saturation checking.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Everything now repeats the same pattern, adding steps to the dictionary</span>
<span class="c1">#</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">)</span>
<span class="n">stepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dqi&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zsig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zoff&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;blev&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;nlin&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;driz&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;phot&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;cr&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">calwf3_run</span><span class="p">(</span><span class="n">file_raw</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_ima.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ZSIG&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calwf3 complete: output saved in icol26k3q_ima.fits
[ 54657.  54631.  54790.  38868.  40529.]
[ 153.07583618  153.03955078  153.26138306  129.16957092  131.88861084]
[    0.     0.     0.     0.  2048.]
</pre></div></div>
</div>
<p>By the way, since we start using them, let’s check the values stored in
the reference files for our pixel</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nlinfile</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NLINFILE&#39;</span><span class="p">]</span>
<span class="n">iref</span> <span class="o">=</span> <span class="s2">&quot;../calfiles/&quot;</span>
<span class="n">hdulist_nlinfile</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">iref</span><span class="o">+</span><span class="n">nlinfile</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>  <span class="c1">#not too elegant, but it works</span>
<span class="c1">#</span>
<span class="c1">#the &quot;superbias&quot; value is at extension 17</span>
<span class="n">bias</span> <span class="o">=</span> <span class="n">hdulist_nlinfile</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="c1">#</span>
<span class="c1">#the &quot;saturation&quot; value is at extension 16</span>
<span class="n">saturation</span> <span class="o">=</span> <span class="n">hdulist_nlinfile</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">saturation</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="c1">#</span>
<span class="c1">#the &quot;readnoise&quot; value is at extension 18</span>
<span class="n">ron</span> <span class="o">=</span> <span class="n">hdulist_nlinfile</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ron</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>



</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 54657.  54631.  54790.  38868.  40529.]
33956.9314645
29.2343
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#there is something strange in these values: the saturation value is way too low with respect</span>
<span class="c1">#to the actual values at the peak of a bright star.</span>
<span class="c1">#</span>
<span class="c1">#However, if we subtract the bias from the data...</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">bias</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="c1">#and add the bias at the saturation value...</span>
<span class="nb">print</span><span class="p">(</span><span class="n">saturation</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="n">bias</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="c1">#we are basically ok. Not transparent, but the pipeline is a black box that takes care of this...</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 44112.  44086.  44245.  28323.  29984.]
44501.9314645
</pre></div></div>
</div>
</div>
<div class="section" id="Step-3:-ZOFF-–-IR-Zero-read-Image-Subtraction">
<h2>Step 3: ZOFF – IR Zero-read Image Subtraction<a class="headerlink" href="#Step-3:-ZOFF-–-IR-Zero-read-Image-Subtraction" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Header Switch: ZOFFCORR</li>
<li>Header Keywords Updated: None</li>
<li>Reference Files: None</li>
</ul>
<p>ZOFFCORR subtracts the zeroth read from all readouts in the exposure,
including the zeroth read itself, resulting in a zero-read image that is
exactly zero in the remainder of processing. The zeroth-read image is
propagated through the remaining processing steps and included in the
output products, so that a complete history of error estimates and data
quality (DQ) flags is preserved.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">)</span>
<span class="n">stepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dqi&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zsig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zoff&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;blev&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;nlin&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;driz&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;phot&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;cr&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">calwf3_run</span><span class="p">(</span><span class="n">file_raw</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_ima.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ZOFF&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calwf3 complete: output saved in icol26k3q_ima.fits
[ 29120.  29094.  29253.  13331.  14992.]
[ 111.88817596  111.83851624  112.14187622   75.97058105   80.50688171]
[    0.     0.     0.     0.  2048.]
</pre></div></div>
</div>
</div>
<div class="section" id="Step-4:-DARK-–-IR-Dark-Image-Subtraction">
<h2>Step 4: DARK – IR Dark Image Subtraction<a class="headerlink" href="#Step-4:-DARK-–-IR-Dark-Image-Subtraction" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Header Switch: DARKCORR</li>
<li>Header Keywords Updated: MEANDARK</li>
<li>Reference File: DARKFILE (<a href="#id7"><span class="problematic" id="id8">*</span></a>_drk.fits)</li>
</ul>
<p>DARKCORR subtracts the detector dark current from the science data. Due
to potential non-linearities in some of the signal components, such as
reset-related effects in the first one or two reads of an exposure, the
dark current subtraction is not applied by simply scaling a generic
reference dark image to the exposure time and then subtracting it.
Instead, a library of dark current images is maintained that includes
darks taken in each of the available predefined MultiAccum sample
sequences, as well as the available sub-array readout modes. The
MultiAccum dark reference file is subtracted read-by-read from the stack
of science image readouts. Thus there is an exact match in the timings
and other characteristics of the dark image that is subtracted from each
science readout. The DARKFILE reference file must have the same values
for the DETECTOR, CCDAMP, CCDGAIN, SAMP_SEQ, and SUBTYPE keywords as the
science image.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">)</span>
<span class="n">stepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dqi&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zsig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zoff&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;blev&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;nlin&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;driz&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;phot&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;cr&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">calwf3_run</span><span class="p">(</span><span class="n">file_raw</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_ima.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">4</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">4</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">4</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;DARK&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calwf3 complete: output saved in icol26k3q_ima.fits
[ 29115.75585938  29093.2890625   29254.41796875  13331.67675781  14992.        ]
[ 111.89044189  111.84100342  112.14394379   75.97402954   80.50688171]
[    0.     0.     0.     0.  2048.]
</pre></div></div>
</div>
</div>
<div class="section" id="Step-5:-BLEV-–-IR-Bias-Level-Correction-From-Reference-Pixels">
<h2>Step 5: BLEV – IR Bias Level Correction From Reference Pixels<a class="headerlink" href="#Step-5:-BLEV-–-IR-Bias-Level-Correction-From-Reference-Pixels" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Header Switch: BLEVCORR</li>
<li>Header Keywords Updated: MEANBLEV</li>
<li>Reference Files: OSCNTAB (<a href="#id9"><span class="problematic" id="id10">*</span></a>_osc.fits)</li>
</ul>
<p>BLEVCORR uses the reference pixels located around the perimeter of the
IR detector to track and remove changes in the bias level that occur
during an exposure. For each raw readout, the mean signal level of the
reference pixels is computed and subtracted from the image, and recorded
in the MEANBLEV keyword in the SCI header of each readout. The reference
pixels located at the ends of each image row are used in this
computation. Reference pixels are also located along the bottom and top
of the image, but these have been found to be less reliable and are not
used. As with the UVIS overscan correction, the boundaries of the
reference pixel regions that are used in the computation are defined in
the OSCNTAB reference table, in the BIASSECT* columns. The
BIASSECTA[1,2] values indicate the starting and ending column numbers
for the reference pixels on the left edge of the image, and the
BIASSECTB[1,2] give the values for the right side of the image. The
reference pixel regions are maintained throughout the remainder of
processing, but are usually ignored or skipped over in the actual
application of calibration algorithms. They are left in place in the
calibrated data stored in the ima file at the end of processing, but are
trimmed from the flt image file. The reference file for bias level
correction, OSCNTAB, is selected from CDBS based on the value of the
DETECTOR keyword only.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">)</span>
<span class="n">stepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dqi&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zsig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zoff&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;blev&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;nlin&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;driz&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;phot&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;cr&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">calwf3_run</span><span class="p">(</span><span class="n">file_raw</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_ima.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">5</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">5</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">5</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;BLEV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calwf3 complete: output saved in icol26k3q_ima.fits
[ 29119.53320312  29096.16796875  29255.99609375  13332.16015625
  14991.99902344]
[ 111.8976593   111.84650421  112.1469574    75.97538757   80.50688171]
[    0.     0.     0.     0.  2048.]
</pre></div></div>
</div>
</div>
<div class="section" id="Step-6:-NLIN-–-IR-Non-Linearity-Correction">
<h2>Step 6: NLIN – IR Non-Linearity Correction<a class="headerlink" href="#Step-6:-NLIN-–-IR-Non-Linearity-Correction" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Header Switch: NLINCORR</li>
<li>Header Keywords Updated: None</li>
<li>Reference File: NLINFILE (<a href="#id11"><span class="problematic" id="id12">*</span></a>_lin.fits)</li>
</ul>
<p>NLINCORR corrects the integrated counts in the science images for the
non-linear response of the detector and flags pixels that go into
saturation. The observed response of the detector can be conveniently
represented by two regimes:</p>
<ol class="arabic simple">
<li>At low and intermediate signal levels the detector response deviates
from the incident flux in a way that is correctable using the
following expression: where c1, c2. c 3 and c4 are the correction
coefficients, F is the uncorrected flux (in DN) and Fc is the
corrected flux. The current form of the correction uses a third-order
polynomial, as shown here, but the algorithm can handle an arbitrary
number of coefficients. The number of coefficients and error terms
are given by the values of the NCOEF and NERR keywords in the header
of the NLINFILE.</li>
<li>At high signal levels as saturation sets in the response becomes
highly non-linear and is not correctable to a scientifically useful
degree. This step uses the NLINFILE reference file, which includes a
set of images containing the cn correction coefficients and their
variances at each pixel. The [NODE,1] image extension in the NLINFILE
gives the saturation value for each pixel, in units of DN. Each pixel
that has an input value below its defined saturation level is
corrected according to the equation above. Pixels at or above their
saturation values receive no correction and are flagged as saturated
in the DQ array for the readout. Any pixel flagged as saturated in a
given readout is also automatically flagged as saturated in all
subsequent readouts. As mentioned in the description of the ZSIGCORR
routine, the estimated amount of signal in the zeroth read of the
exposure is temporarily added back into the signal of each pixel
during the NLINCORR step, before the pixel is checked for saturation
or receives the linearity correction. Once the correction has been
applied, the zero read signal is again removed. This process only
occurs if the ZSIGCORR step is turned on during processing. The
NLINFILE reference files is selected based on the value of the
DETECTOR keyword only.</li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">)</span>
<span class="n">stepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dqi&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zsig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zoff&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;blev&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;nlin&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;driz&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;phot&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;cr&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">calwf3_run</span><span class="p">(</span><span class="n">file_raw</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_ima.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">6</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">6</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">6</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;NLIN&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calwf3 complete: output saved in icol26k3q_ima.fits
[ 29119.53320312  29096.16796875  29255.99609375  13980.02246094
  15081.25097656]
[ 111.8976593   111.84650421  112.1469574    75.97538757   80.50688171]
[ 2304.  2304.  2304.  2048.  2048.]
</pre></div></div>
</div>
</div>
<div class="section" id="Step-7:-FLAT-–-IR-Flat-field-Image-Correction">
<h2>Step 7: FLAT – IR Flat-field Image Correction<a class="headerlink" href="#Step-7:-FLAT-–-IR-Flat-field-Image-Correction" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Header Switch: FLATCORR</li>
<li>Header Keywords Updated: None</li>
<li>Reference Files: PFLTFILE(<a href="#id13"><span class="problematic" id="id14">*</span></a>_pfl.fits),LFLTFILE(<a href="#id15"><span class="problematic" id="id16">*</span></a>_lfl.fits),DFLTFILE
(<a href="#id17"><span class="problematic" id="id18">*</span></a>_dfl.fits)</li>
</ul>
<p>FLATCORR corrects for pixel-to-pixel and large-scale sensitivity
variations across the detector by dividing the science images by one or
more flat-field images. A combined flat is created within calwf3 using
up to three flat-field reference files: the pixel-to-pixel flat (c), the
low-order flat (LFLTFILE), and the delta flat (DFLTFILE). FLATCORR also
multiplies the science data by the detector gain so that the calibrated
data will be in units of electrons per second (or electrons if UNITCORR
is not performed).</p>
<p>The PFLTFILE is a pixel-to-pixel flat-field correction file containing
the small-scale flat-field variations. The PFLTFILE is always used in
the calibration pipeline, while the other two flats are optional. The
LFLTFILE is a low-order flat that corrects for any large-scale
sensitivity variations across the detector. This file can be stored as a
binned image, which is then expanded when being applied by calwf3.
Finally, the DFLTFILE is a delta-flat containing any needed changes to
the small-scale PFLTFILE.</p>
<p>If the LFLTFILE and DFLTFILE are not specified in the SCI header, only
the PFLTFILE is used for the flat-field correction. If two or more
reference files are specified, they are read in and multiplied together
to form a combined flat-field correction image.</p>
<p>The flat-field correction is applied to all readouts of the calibrated
IR MultiAccum stack, as well as the single image produced by the CRCORR
function.</p>
<p>All flat-field reference images are chosen from CDBS based on the
DETECTOR, CCDAMP, and FILTER used for the observation. A sub-array
science image uses the same reference file(s) as a full-size image;
calwf3 extracts the appropriate region from the reference file(s) and
applies it to the sub-array input image. See the discussion of this step
in ‘UVIS Flat-Field Image Correction’ for information regarding
corrections for geometric distortion.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">)</span>
<span class="n">stepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dqi&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zsig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zoff&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;blev&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;nlin&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;driz&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;phot&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;cr&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">calwf3_run</span><span class="p">(</span><span class="n">file_raw</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_ima.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">7</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">7</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">7</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;FLAT&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calwf3 complete: output saved in icol26k3q_ima.fits
[ 66578.5234375   66525.1015625   66890.53125     31963.74414062
  34481.578125  ]
[ 319.56039429  319.37469482  320.55462646  196.53363037  209.08392334]
[ 2304.  2304.  2304.  2048.  2048.]
</pre></div></div>
</div>
</div>
<div class="section" id="Step-8:-DRIZ-–-Combine-the-files-in-an-association-by-calling-AstroDrizzle">
<h2>Step 8: DRIZ – Combine the files in an association by calling <a class="reference external" href="http://drizzlepac.stsci.edu">AstroDrizzle</a><a class="headerlink" href="#Step-8:-DRIZ-–-Combine-the-files-in-an-association-by-calling-AstroDrizzle" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">)</span>
<span class="n">stepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dqi&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zsig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zoff&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;blev&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;nlin&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;driz&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;phot&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;cr&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">calwf3_run</span><span class="p">(</span><span class="n">file_raw</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_ima.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">8</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">8</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">8</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;DRIZ&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calwf3 complete: output saved in icol26k3q_ima.fits
[ 66578.5234375   66525.1015625   66890.53125     31963.74414062
  34481.578125  ]
[ 319.56039429  319.37469482  320.55462646  196.53363037  209.08392334]
[ 2304.  2304.  2304.  2048.  2048.]
</pre></div></div>
</div>
</div>
<div class="section" id="Step-9:-PHOT-–-IR-Photometry-Keyword-Calculation">
<h2>Step 9: PHOT – IR Photometry Keyword Calculation<a class="headerlink" href="#Step-9:-PHOT-–-IR-Photometry-Keyword-Calculation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Header Switch: PHOTCORR</li>
<li>Header Keywords Updated: PHOTMODE, PHOTFLAM, PHOTFNU, PHOTZPT,
PHOTPLAM, PHOTBW</li>
<li>Reference Files: GRAPHTAB (<a href="#id19"><span class="problematic" id="id20">*</span></a>_tmg.fits), COMPTAB (<a href="#id21"><span class="problematic" id="id22">*</span></a>_tmc.fits)</li>
</ul>
<p>Before photometry can be derived from WFC3 observations, a
transformation to absolute flux units must be done. calwf3 follows the
WFPC2 and ACS methodology for calculating the photometry keywords in the
calibration pipeline. The calibration reference file IMPHTTAB contains
the values of the latest WFC3 photometry keywords as calculated by
pysynphot as a function of wavelength for the various WFC3 detector and
filter combinations.For further discussion of pysynphot, refer to
Chapter 3 of the Introduction to the HST Data Handbooks.</p>
<p>During this process the keyword PHOTMODE is built to reflect the
configuration of the instrument for the exposure (e.g.,
‘WFC3,IR,F160W’). calwf3 then uses the PHOTMODE string with pysynphot to
compute the total throughput for this instrument mode, based on the
optics and filter throughputs and the detector QE. From that
information, it computes values for the following photometry keywords.</p>
<p>PHOTFLAM: the inverse sensitivity in units of erg cm-2 A-1 electron-1</p>
<p>PHOTFNU: the inverse sensitivity in units of Jy sec-1 electron-1</p>
<p>PHOTZPT: the Space Telescope magnitude zero point</p>
<p>PHOTPLAM: the bandpass pivot wavelength</p>
<p>PHOTBW: the bandpass RMS width</p>
<p>Users who wish to convert calibrated IR images (which are in units of
electrons per second) to flux units can simply multiply the image by the
PHOTFNU keyword value.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">)</span>
<span class="n">stepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dqi&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zsig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zoff&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;blev&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;nlin&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;driz&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;phot&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;cr&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">calwf3_run</span><span class="p">(</span><span class="n">file_raw</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_ima.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">9</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">9</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">9</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;PHOT&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calwf3 complete: output saved in icol26k3q_ima.fits
[ 66578.5234375   66525.1015625   66890.53125     31963.74414062
  34481.578125  ]
[ 319.56039429  319.37469482  320.55462646  196.53363037  209.08392334]
[ 2304.  2304.  2304.  2048.  2048.]
</pre></div></div>
</div>
</div>
<div class="section" id="Step-10:-UNIT-–-IR-Unit-Conversion">
<h2>Step 10: UNIT – IR Unit Conversion<a class="headerlink" href="#Step-10:-UNIT-–-IR-Unit-Conversion" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Header Switch: UNITCORR</li>
<li>Header Keywords Updated: BUNIT</li>
<li>Reference Files: None</li>
</ul>
<p>This function simply converts the science data from a time-integrated
signal to a signal rate, by dividing the science (SCI) and error (ERR)
image arrays for each readout by the exposure time (TIME) image data. No
reference file is needed.</p>
<p>Usually, the final units will be electrons per second, but if certain
steps in the standard processing are omitted, the final units in the ima
and flt files may be electrons, counts, or counts per second, where
counts refers to the digitized signal from the FPA. The BUNIT keyword in
the output files will always reflect the units of the data.`</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">)</span>
<span class="n">stepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dqi&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zsig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zoff&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;blev&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;nlin&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;driz&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;phot&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;cr&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
<span class="n">calwf3_run</span><span class="p">(</span><span class="n">file_raw</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_ima.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">10</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">10</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">10</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;UNIT&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calwf3 complete: output saved in icol26k3q_ima.fits
[   219.77955627    327.81820679    649.84790039  10900.60449219
  11842.19335938]
[  1.05488718   1.57379448   3.11421871  67.02391052  71.80682373]
[ 2304.  2304.  2304.  2048.  2048.]
</pre></div></div>
</div>
</div>
<div class="section" id="Step-11:-CR-–-IR-Up-The-Ramp-Fitting-and-Cosmic-Ray-Identification">
<h2>Step 11: CR – IR Up-The-Ramp Fitting and Cosmic-Ray Identification<a class="headerlink" href="#Step-11:-CR-–-IR-Up-The-Ramp-Fitting-and-Cosmic-Ray-Identification" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Header Switch: CRCORR</li>
<li>Header Keywords Updated: None</li>
<li>Reference Files: None</li>
</ul>
<p>CRCORR combines the data from all readouts into a single image and in
the process identifies and flags pixels suspected of containing
cosmic-ray (CR) hits. The data from all readouts are analyzed
pixel-by-pixel, iteratively computing a linear fit to the accumulating
counts-versus-exposure time relation. Samples flagged as bad in the DQ
arrays, such as when saturation occurs midway through the exposure, are
rejected from the fitting process. CR hits are identified by searching
for outliers from the fit results. The rejection threshold is set by the
value in the ‘CRSIGMAS’ column of the Cosmic-Ray Rejection parameters
reference table (CRREJTAB), which currently has a default value of 4s.
When a CR hit is detected, a linear fit is then performed independently
for the sets of readouts before and after the hit. Those fitting results
are then again checked for outliers. This process is iterated until no
new samples are rejected. Pixel samples identified as containing a CR
hit are flagged in the DQ arrays of the intermediate MultiAccum (ima)
file, with a DQ value of 8192. The pixel values in the SCI and ERR
images of the ima file, however, are left unchanged. These DQ flags are
only present in the ima file and do not get carried over into flt
products which combine data from all readouts.</p>
<p>Once all outliers have been identified, a final count rate value, and
its uncertainty, are determined for each pixel by computing the weighted
mean of the slopes of each segment of non-flagged samples. The result of
this operation is stored as a single imset in the output flt file. In
the flt file the SCI array contains the final slope computed for each
pixel, the ERR array contains the estimated uncertainty in the slope,
the SAMP array contains the total number of non-flagged samples used to
compute the slope, and the TIME array contains the total exposure time
of those samples. Pixels for which there are no unflagged samples, e.g.,
permanently hot or cold pixels, still get a slope computed, which is
recorded in the SCI array of the output flt file, but they will also
have their DQ flags recorded in the DQ array of the flt file. Users
should therefore be careful to always check the flt file DQ arrays to
help determine whether a given SCI image value is trustworthy for
subsequent analysis.</p>
<p>The basic rule of thumb is that in order for a DQ value to propagate
into the flt, it needs to be present in all the reads of the flt. The
8192 flag does not get propagated because it shows where during the ramp
the cosmic ray showed up. Nominally, when looking at the flt file,
calwf3 has already dealt with the cosmic ray and its effects are gone.
If a user really wants to know about those cosmic rays, the ima files
are available and contain the complete record of when and where exactly
each cosmic ray showed up.</p>
<p>Another flag that is treated this way is saturation, flag value = 256.
If a pixel is saturated in the last two reads of a ramp, then those two
reads are flagged with 256 in the ima, calwf3 ignores those reads during
line-fitting. The DQ value put into the flt file is 0 because calwf3 has
already dealt with the saturation and the effects are not in the flt.</p>
<p>For pixels where calwf3 finds 4 or more cosmic rays up the ramp, it
flags the pixel with flag value = 4 (“dead” or bad pixel), which does
propagate to the flt. In that case, the thinking is that four large
signal jumps for a given pixel in a single ramp means that something is
going on with that pixel, and it should be thrown out.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_ima.fits&quot;</span><span class="p">)</span>
<span class="n">stepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dqi&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zsig&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;zoff&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;dark&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;blev&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;nlin&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;driz&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;phot&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span><span class="s1">&#39;cr&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
<span class="n">calwf3_run</span><span class="p">(</span><span class="n">file_raw</span><span class="p">,</span> <span class="n">stepdict</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s1">&#39;_ima.fits&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">error</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">),:,:]</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
<span class="n">listout</span><span class="p">[</span><span class="mi">11</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">errout</span><span class="p">[</span><span class="mi">11</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">error</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">dqout</span><span class="p">[</span><span class="mi">11</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dq</span><span class="p">[:,</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span>
<span class="n">stepname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;CR&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
calwf3 complete: output saved in icol26k3q_ima.fits
[   219.77955627    327.81820679    649.84790039  10900.60449219
  11842.19335938]
[  1.05488718   1.57379448   3.11421871  67.02391052  71.80682373]
[ 2304.  2304.  2304.  2048.  2048.]
</pre></div></div>
</div>
</div>
<div class="section" id="Done!">
<h2>Done!<a class="headerlink" href="#Done!" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Here is the final summary for pixel&#39;</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">stepname</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">listout</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   err&#39;</span><span class="p">,</span><span class="n">errout</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    dq&#39;</span><span class="p">,</span><span class="n">dqout</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
<span class="n">hdulist</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filebase</span><span class="o">+</span><span class="s2">&quot;_flt.fits&quot;</span><span class="p">)</span>
<span class="n">countrate</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">errorrate</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">dqrate</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Here is the final countrate:&#39;</span><span class="p">,</span><span class="n">countrate</span><span class="p">[</span><span class="n">jj</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="n">ii</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        the final error    :&#39;</span><span class="p">,</span><span class="n">errorrate</span><span class="p">[</span><span class="n">jj</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="n">ii</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        the final dq       :&#39;</span><span class="p">,</span><span class="n">dqrate</span><span class="p">[</span><span class="n">jj</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="n">ii</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(&#39;Here is the final summary for pixel&#39;, 446, 721)
(0, &#39;RAW&#39;, array([ 54657.,  54631.,  54790.,  38868.,  25537.]))
(&#39;   err&#39;, array([ nan,  nan,  nan,  nan,  nan]))
(&#39;    dq&#39;, array([ nan,  nan,  nan,  nan,  nan]))
(1, &#39;DQI&#39;, array([ 54657.,  54631.,  54790.,  38868.,  25537.]))
(&#39;   err&#39;, array([ 153.076,  153.04 ,  153.261,  129.17 ,  104.823]))
(&#39;    dq&#39;, array([ 0.,  0.,  0.,  0.,  0.]))
(2, &#39;ZSIG&#39;, array([ 54657.,  54631.,  54790.,  38868.,  40529.]))
(&#39;   err&#39;, array([ 153.076,  153.04 ,  153.261,  129.17 ,  131.889]))
(&#39;    dq&#39;, array([    0.,     0.,     0.,     0.,  2048.]))
(3, &#39;ZOFF&#39;, array([ 29120.,  29094.,  29253.,  13331.,  14992.]))
(&#39;   err&#39;, array([ 111.888,  111.839,  112.142,   75.971,   80.507]))
(&#39;    dq&#39;, array([    0.,     0.,     0.,     0.,  2048.]))
(4, &#39;DARK&#39;, array([ 29115.756,  29093.289,  29254.418,  13331.677,  14992.   ]))
(&#39;   err&#39;, array([ 111.89 ,  111.841,  112.144,   75.974,   80.507]))
(&#39;    dq&#39;, array([    0.,     0.,     0.,     0.,  2048.]))
(5, &#39;BLEV&#39;, array([ 29119.533,  29096.168,  29255.996,  13332.16 ,  14991.999]))
(&#39;   err&#39;, array([ 111.898,  111.847,  112.147,   75.975,   80.507]))
(&#39;    dq&#39;, array([    0.,     0.,     0.,     0.,  2048.]))
(6, &#39;NLIN&#39;, array([ 29119.533,  29096.168,  29255.996,  13980.022,  15081.251]))
(&#39;   err&#39;, array([ 111.898,  111.847,  112.147,   75.975,   80.507]))
(&#39;    dq&#39;, array([ 2304.,  2304.,  2304.,  2048.,  2048.]))
(7, &#39;FLAT&#39;, array([ 66578.523,  66525.102,  66890.531,  31963.744,  34481.578]))
(&#39;   err&#39;, array([ 319.56 ,  319.375,  320.555,  196.534,  209.084]))
(&#39;    dq&#39;, array([ 2304.,  2304.,  2304.,  2048.,  2048.]))
(8, &#39;DRIZ&#39;, array([ 66578.523,  66525.102,  66890.531,  31963.744,  34481.578]))
(&#39;   err&#39;, array([ 319.56 ,  319.375,  320.555,  196.534,  209.084]))
(&#39;    dq&#39;, array([ 2304.,  2304.,  2304.,  2048.,  2048.]))
(9, &#39;PHOT&#39;, array([ 66578.523,  66525.102,  66890.531,  31963.744,  34481.578]))
(&#39;   err&#39;, array([ 319.56 ,  319.375,  320.555,  196.534,  209.084]))
(&#39;    dq&#39;, array([ 2304.,  2304.,  2304.,  2048.,  2048.]))
(10, &#39;UNIT&#39;, array([   219.78 ,    327.818,    649.848,  10900.604,  11842.193]))
(&#39;   err&#39;, array([  1.055,   1.574,   3.114,  67.024,  71.807]))
(&#39;    dq&#39;, array([ 2304.,  2304.,  2304.,  2048.,  2048.]))
(11, &#39;CR&#39;, array([   219.78 ,    327.818,    649.848,  10900.604,  11842.193]))
(&#39;   err&#39;, array([  1.055,   1.574,   3.114,  67.024,  71.807]))
(&#39;    dq&#39;, array([ 2304.,  2304.,  2304.,  2048.,  2048.]))
(&#39;Here is the final countrate:&#39;, 10900.604)
(&#39;        the final error    :&#39;, 67.023911)
(&#39;        the final dq       :&#39;, 0)
</pre></div></div>
</div>
<div class="section" id="Notes:">
<h3>Notes:<a class="headerlink" href="#Notes:" title="Permalink to this headline">¶</a></h3>
<p>DQ = 2048 =&gt; Signal in Zero Read</p>
<p>DQ = 256 =&gt; Full Well saturation (2048+256=2304)</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, AURA / Space Telescope Science Institute. These documents are designed for internal use only, and are not an official AURA/STScI publication. Information may be out of date, irrelevant, or contradict published documentation. Use at your own risk.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'published 2018-7-30',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>