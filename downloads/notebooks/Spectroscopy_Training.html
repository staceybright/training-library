

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using Python with HST Spectral Data &mdash; RIA Training Library</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Technical Staff Training
          

          
          </a>

          
            
            
              <div class="version">
                published 2018-6-26
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../computer_setup.html">Setting Up Your Computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../version_control.html">Version Control with git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archives.html">Using MAST (a.k.a. the Archive)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Python for Scientific Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apt_etc/index.html">The Astronomer’s Proposal Tool and the Exposure Time Calculator for HST and JWST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../photometry.html">Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drizzle.html">Using DrizzlePac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spectroscopy/index.html">Basic Spectroscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pysynphot.html">Using PySynphot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pysynphot.html#HST-Conclusion"><em>HST</em> Conclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pysynphot.html#Using-PySynphot-for-JWST-and-Advanced-Topics">Using <code class="docutils literal notranslate"><span class="pre">PySynphot</span></code> for <em>JWST</em> and Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pysynphot.html#Conclusion">Conclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../editing_these_documents.html">Editing These Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tricks.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trainees.html">Past Trainees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boneyard.html">Retired topics</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Technical Staff Training</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Using Python with HST Spectral Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/downloads/notebooks/Spectroscopy_Training.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="Using-Python-with-HST-Spectral-Data">
<h1>Using Python with HST Spectral Data<a class="headerlink" href="#Using-Python-with-HST-Spectral-Data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="1.-Retrieving-Data-from-MAST">
<h2>1. Retrieving Data from MAST<a class="headerlink" href="#1.-Retrieving-Data-from-MAST" title="Permalink to this headline">¶</a></h2>
<p><strong>*First, make a directory in your central store to put your data in.*</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/user/myname</span> <span class="pre">mkdir</span> <span class="pre">spect_training</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">spect_training</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">mast_data</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/user/jotaylor/new_hire_training/*fits</span> <span class="pre">.</span></code></p>
<p>For HST spectral data, there are three types of files: * raw * COS:
<code class="docutils literal notranslate"><span class="pre">rawtag</span></code>, <code class="docutils literal notranslate"><span class="pre">rawaccum</span></code>, <code class="docutils literal notranslate"><span class="pre">rawacq</span></code> * STIS: <code class="docutils literal notranslate"><span class="pre">raw</span></code>, <code class="docutils literal notranslate"><span class="pre">tag</span></code>, <code class="docutils literal notranslate"><span class="pre">wav</span></code>
* support * <code class="docutils literal notranslate"><span class="pre">asn</span></code>, <code class="docutils literal notranslate"><span class="pre">spt</span></code>, <code class="docutils literal notranslate"><span class="pre">trl</span></code>, and more * intermediate *
<code class="docutils literal notranslate"><span class="pre">corrtag</span></code>, <code class="docutils literal notranslate"><span class="pre">crj</span></code>, <code class="docutils literal notranslate"><span class="pre">flt</span></code>, and more * products * <code class="docutils literal notranslate"><span class="pre">x1d</span></code>,
<code class="docutils literal notranslate"><span class="pre">x1dsum</span></code></p>
<p>Raw data has undergone no processing besides generic conversion from
spacecraft data to FITS. Intermediate products are files produced by
each instrument’s calibration pipeline on the way to extracting a
spectrum. Products are fully calibrated, extracted 1-D spectra and
typically have <code class="docutils literal notranslate"><span class="pre">x1d</span></code> in the extension. See the Instrument Data
Handbooks for a full list of all data file types.</p>
<p>To retrieve STIS data by its filename, simply enter the name in
“Dataset” field in a <a class="reference external" href="http://archive.stsci.edu/hst/search.php">MAST
search</a>. For COS data,
however, you must search by the individual dataset’s association name
(more info
<a class="reference external" href="http://www.stsci.edu/hst/cos/documents/handbooks/datahandbook/ch2_cos_data5.html#460268">here</a>).</p>
<p><strong>*Retrieve two datasets, lbgu17qnq (association lbgu17010) and
o8k401010 from the archive.*</strong> Be sure to retrieve both un-calibrated
and calibrated products.</p>
<p><code class="docutils literal notranslate"><span class="pre">ls</span></code></p>
<p>First, let’s look at the primary headers and identify some important
parameters.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span>
<span class="n">cos_raw_a</span> <span class="o">=</span> <span class="s2">&quot;lbgu17qnq_rawtag_a.fits&quot;</span>
<span class="n">cos_raw_b</span> <span class="o">=</span> <span class="s2">&quot;lbgu17qnq_rawtag_b.fits&quot;</span>
<span class="n">stis_raw</span> <span class="o">=</span> <span class="s2">&quot;o8k401010_raw.fits&quot;</span>
<span class="n">cos_hdr0</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">cos_raw_a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">cos_hdr0</span>
</pre></div>
</div>
</div>
<p><strong>*Print the STIS header as well.*</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
<p>You can also get individual header keywords. These are not case-specific
in astropy.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DETECTOR: &quot;</span><span class="p">,</span> <span class="n">cos_hdr0</span><span class="p">[</span><span class="s2">&quot;DETECTOR&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;detector: &quot;</span><span class="p">,</span> <span class="n">cos_hdr0</span><span class="p">[</span><span class="s2">&quot;detector&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Let’s get some useful information about the datasets. <strong>*Use a loop like
the one below, but add any other keywords you think should be included.
Make sure the keywords are identical between instruments.*</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">hdr</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cos_hdr0</span><span class="p">,</span> <span class="n">stis_hdr0</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;instrument&quot;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;primesi&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;detector&quot;</span><span class="p">,</span> <span class="s2">&quot;obsmode&quot;</span><span class="p">,</span> <span class="s2">&quot;opt_elem&quot;</span><span class="p">,</span> <span class="s2">&quot;targname&quot;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">hdr</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>What is the difference between ACCUM and TIME-TAG? Let’s look at the
structure of each raw dataset to find out.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">cos_raw_a</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">stis_raw</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>You can get pertinent information of a FITS Table by looking at the
column definitions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cos_raw_a</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdulist</span><span class="p">:</span>
    <span class="n">data1</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data1</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data1</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data1</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data1</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="2.-Calibration">
<h2>2. Calibration<a class="headerlink" href="#2.-Calibration" title="Permalink to this headline">¶</a></h2>
<p>There is a calibration pipeline for each instrument. For COS and STIS,
they are CalCOS and CalSTIS. The pipelines themselves have very limited
optional arguments, and very few will effect the data. Most of the ways
to change how data is calibrated is accessed by editing header keywords
in the raw files.</p>
<p>All of the reference files used by the calibration pipelines are located
in central storage, and the pipelines themselves look to environment
variables to find them. If you have not already done so, you will need
to set these environment variables now.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;oref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/grp/hst/cdbs/oref/&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;lref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/grp/hst/cdbs/lref/&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="kn">from</span> <span class="nn">stistools</span> <span class="k">import</span> <span class="n">calstis</span>
<span class="kn">import</span> <span class="nn">calcos</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CalCOS version: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calcos</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CalCOS vdate: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calcos</span><span class="o">.</span><span class="n">__vdate__</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CalSTIS version: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calstis</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CalSTIS vdate: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calstis</span><span class="o">.</span><span class="n">__vdate__</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
calstis.calstis<span class="o">?</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
calcos.calcos<span class="o">?</span>
</pre></div>
</div>
</div>
<p>You have already received calibrated products from the archive, but
sometimes you may decide to turn certain calibration switches on or off
to modify data. Let’s try turning off background subtraction switch,
<code class="docutils literal notranslate"><span class="pre">BACKCORR</span></code>, then re-calibrating the data. It’s a good idea to print to
the screen/capture the trailer file that a pipeline creates- it shows
step-by-step records of how the data were calibrated and will record any
errors that occur. You will need to specify a different output directory
to make sure that the pipelines will not overwrite the data you already
have.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="k">for</span> <span class="n">cosfile</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cos_raw_a</span><span class="p">,</span> <span class="n">cos_raw_b</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before, </span><span class="si">{0}</span><span class="s2"> BACKCORR=</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cosfile</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">cosfile</span><span class="p">,</span><span class="s2">&quot;BACKCORR&quot;</span><span class="p">)))</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cosfile</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdulist</span><span class="p">:</span>
        <span class="n">hdr0</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="n">hdr0</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;BACKCORR&quot;</span><span class="p">,</span> <span class="s2">&quot;OMIT&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After, </span><span class="si">{0}</span><span class="s2"> BACKCORR=</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cosfile</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">cosfile</span><span class="p">,</span><span class="s2">&quot;BACKCORR&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">cos_backcorr_omit</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="c1"># calcos.calcos(cos_asn, outdir=&quot;cos_backcorr_omit&quot;)</span>
<span class="n">cp</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">jotaylor</span><span class="o">/</span><span class="n">new_hire_training</span><span class="o">/</span><span class="n">cos_backcorr_omit</span><span class="o">/*</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">myname</span><span class="o">/</span><span class="n">spect_training</span><span class="o">/</span><span class="n">cos_backcorr_omit</span>
</pre></div>
</div>
</div>
<p><strong>*Change the BACKCORR switch for the STIS data and calibrate the data.
You mut first create the output directory for CalSTIS.*</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># your code here to change BACKCORR</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">stis_backcorr_omit</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Calibrate the STIS raw file, and be sure to specify a trailing slash for the output directory.</span>
<span class="n">calstis</span><span class="o">.</span><span class="n">calstis</span><span class="p">(</span><span class="n">stis_raw</span><span class="p">,</span> <span class="n">outroot</span><span class="o">=</span><span class="s2">&quot;stis_backcorr_omit/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">corrtag</span></code> files are very useful, but they are only produced for COS
data. Instead, let’s look at the unmodified <code class="docutils literal notranslate"><span class="pre">x1d</span></code> products for both
COS and STIS. <strong>*Explore the 1st extension data for the original COS and
STIS ``x1d`` files, looking at the columns and names as we did
before.*</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="n">orig_cos_x1dfile</span> <span class="o">=</span> <span class="s2">&quot;lbgu17qnq_x1d.fits&quot;</span>
<span class="n">orig_stis_x1dfile</span> <span class="o">=</span> <span class="s2">&quot;o8k401010_x1d.fits&quot;</span>
<span class="n">cos_x1d_orig</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">orig_cos_x1dfile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">stis_x1d_orig</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">orig_stis_x1dfile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">x1d</span></code> files can have strange formats. Let’s fix that…</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cos_x1d_orig</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cos_x1d_orig</span><span class="p">[</span><span class="s2">&quot;segment&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stis_x1d_orig</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">cos_wl_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cos_x1d_orig</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cos_x1d_orig</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">cos_flux_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cos_x1d_orig</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cos_x1d_orig</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">stis_wl_orig</span> <span class="o">=</span> <span class="n">stis_x1d_orig</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">stis_flux_orig</span> <span class="o">=</span> <span class="n">stis_x1d_orig</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cos_wl_orig</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stis_wl_orig</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>*Read in the BACKCORR=OMIT COS and STIS data and assign the wavelength
and flux to arrays.*</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
<p>Now let’s compare the COS data that has been calibrated with
<code class="docutils literal notranslate"><span class="pre">BACKCORR=PERFORM</span></code> to <code class="docutils literal notranslate"><span class="pre">BACKCORR=OMIT</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;bmh&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Run this cell.</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cos_wl_new</span><span class="p">,</span> <span class="n">cos_flux_new</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightseagreen&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;WAVECORR=OMIT&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cos_wl_orig</span><span class="p">,</span> <span class="n">cos_flux_orig</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;WAVECORR=PERFORM&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cos_wl_new</span><span class="p">,</span> <span class="n">cos_flux_orig</span><span class="o">-</span><span class="n">cos_flux_new</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength [$\AA$]&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Flux [ergs/s/cm$^2$/$\AA$]&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Flux [ergs/s/cm$^2$/$\AA$]&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;COS </span><span class="si">{0}</span><span class="s2"> BACKCORR=PERFORM&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cos_hdr0</span><span class="p">[</span><span class="s2">&quot;targname&quot;</span><span class="p">]))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;BACKCORR=PERFORM - BACKCORR=OMIT&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>*Now make a similar plot for STIS.*</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Interpolating-Data">
<h2>Interpolating Data<a class="headerlink" href="#Interpolating-Data" title="Permalink to this headline">¶</a></h2>
<p><strong>*Make a very simple plot with both the COS and STIS spectra.*</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Use plt.plot instead of plt.subplots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">color</span><span class="o">=...</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Directly comparing two spectra in wavelength space cannot be done
quantitatively unless both datasets have the same wavelength scale.
Interpolating one spectrum onto another’s wavelength scale will allow
you to do far more useful calculations such as dividing, subtracting,
etc. <strong>*Follow the example below to perform a linear interpolation of
the STIS x1d file onto the wavelength scale of the COS x1d (use the
original files, not the BACKCORR=OMIT files).*</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#import numpy as np</span>
<span class="c1">#flux2_interpolated = np.interp(wavel1, wavel2, flux2)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
<p><strong>*Now divide the two spectra by each other to see where the two differ.
Make a plot of the product.*</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Smoothing-Data">
<h2>Smoothing Data<a class="headerlink" href="#Smoothing-Data" title="Permalink to this headline">¶</a></h2>
<p>The COS data we have is at a much higher resolution than that of STIS.
<strong>*Smooth the original COS data with a boxcar filter. Try 3 different
box sizes: 6, 11, and 21. Make a plot of the original and all smoothed
spectra. (Hint: try a loop) (Double hint: try xlim(1220, 1245) and
ylim(-0.1e-12, 0.7e-12)*</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#from stsci.convolve import boxcar</span>
<span class="c1">#smoothed_flux = boxcar(flux, (boxcar_size,))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Computing-SNR">
<h2>Computing SNR<a class="headerlink" href="#Computing-SNR" title="Permalink to this headline">¶</a></h2>
<p>The signal-to-noise ratio, SNR, is an important statistic of spectra.
Signal can be approximated with a low-order polynomial fit to a
continuum region where there are no absorption or emission features.
Noise can be approximated as the standard deviation of the fit
subtracted from the data. <strong>*Smooth the COS data using boxcar=6, and
STIS data using boxcar=2. Then, follow the example below to determine
the average SNR for the COS and STIS data.*</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#poly2 = np.polyfit(wavelength_region, smoothed_flux_region, 2)</span>
<span class="c1">#fit2 = np.poly1d(poly2)</span>
<span class="c1">#ycalc = fit2(wavelength_region)</span>
<span class="c1">#noise = np.std(smoothed_flux_region - ycalc)</span>
<span class="c1">#signal = np.average(ycalc)</span>
<span class="c1">#snr = signal / noise</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, AURA / Space Telescope Science Institute. These documents are designed for internal use only, and are not an official AURA/STScI publication. Information may be out of date, irrelevant, or contradict published documentation. Use at your own risk.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'published 2018-6-26',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>