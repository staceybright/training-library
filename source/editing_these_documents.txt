***********************
Editing These Documents
***********************

These documents live in a ``git`` repository, making it easy for you to modify them and share your changes with other RIAs. GitHub is the service we use to coordinate sharing and reviewing the changes. You can find the web interface to the repository at https://github.com/josephoenix/riatraining.

To conclude your RIA training, we want you to add your name to the :doc:`list of trainees <trainees>`.

.. warning::

   For now, the documents are at https://github.com/josephoenix/riatraining, and you need someone to add you as a collaborator before you can access them. Follow the instructions in :ref:`getting_started_github` and ask someone to add you as a collaborator.

.. _making_and_previewing_changes:

Making and previewing changes
=============================

The first step to making a change is to clone the repository, giving you a local copy to work with::

   git clone git@github.com:josePhoenix/riatraining.git

This creates a ``riatraining`` directory in whatever folder you're in. The web pages you're reading now are automatically generated from the ``.txt`` files in the ``source`` subdirectory. To generate them on your computer, you need to install required packages from ``requirements.txt``::

   cd riatraining/
   pip install -r requirements.txt

This installs the program that builds the web pages from the source files, as well as components it depends on. To make a change, edit the ``.txt`` or ``.tex`` source for the document and then run::

   make riadocs

This builds HTML files for the webpages, as well as PDFs for those documents written in LaTeX. The generated HTML for the webpages is now in ``build/html/``. You can open ``build/html/index.html`` (or another file) to see your handiwork.

See :ref:`publishing_changes` for how to incorporate your changes in the published version.

.. _autobuilder:

A simpler workflow
------------------

There's a helper script that will rebuild (``make riadocs``) the pages every time you edit and save a file. Run ``python autobuilder.py`` from your terminal, and a browser window will pop open pointing to a local preview copy at http://127.0.0.1:8000/.

While the autobuilder is running, any changes to ``.txt`` files will trigger a rebuild when you save them. Make your edits, save, and refresh the page in your browser to see your changes.

Quit the autobuilder by interrupting it with :kbd:`Control-c`.

Finishing your RIA training
===========================

For the last part of your training, you will make a small change to these documents and publish your changes for all to see.

Editing the trainee list
------------------------

:doc:`trainees` is a page on this site listing all the RIAs who have completed this training. You will edit this page to add your name to the list. Recall from :doc:`version_control` that it's a good idea to make changes on a separate branch. Make a new branch called ``last_exercise_yourlastname``.

.. admonition:: Exercise: Add your name to "Past RIA Trainees"
   :class: note

   Edit the source file to add your name in the appropriate section.

Verify your changes worked using either the :ref:`autobuilder script <autobuilder>` or ``make html``. Once you're satisfied, commit the changes to your branch.

.. admonition:: Exercise: Push your changes for review
   :class: note

   Push your changes to a new branch on the origin repository. (i.e. ``git push origin last_exercise_yourlastname``).

Making a pull request on GitHub
-------------------------------

GitHub would not stop you from merging your own edits, but it is considered good practice to give other collaborators a chance to review your changes.

Once you have pushed to a new branch, when you visit https://github.com/josephoenix/riatraining you will see a new green icon to "Compare & pull request".

.. figure:: figures/compare_and_pull_request.png
   :scale: 50 %
   :alt: GitHub's two buttons for "Compare & pull request"

Click the big green "Compare & pull request" button. (The smaller green pull request icon next to the branch selector will also work, but you will have to remember to select the right branch.)

At the bottom of the page, you'll see the changes you're asking to pull in. Ensure you're only pulling in changes you mean to!

.. figure:: figures/pull_request_files.png
   :scale: 50 %
   :alt: View of the changes in the pull request diff

.. warning::

   If you see a message saying that the branches cannot be automatically merged, you need to "pull in upstream changes". All that means is that someone else edited the same thing as you, and you need to incorporate their changes in your pull request.

   To do this, go to your repository in the terminal and execute ``git pull`` and ``git merge master``. You will see a message about which files have conflicts. Open them in your editor, look for the ``<<<<<<`` and ``>>>>>>`` markers, and combine the changes in a way that makes sense (e.g. include your name *and* that of another trainee that just added theirs).

   Add, commit, push to your branch, and your pull request should gain the green "Able to merge" icon!

Give your pull request a brief title and description, then click "Create pull request." Tell your trainer for this section, and they will merge it in if it all looks good! Once it is merged, either you or they can publish it using the directions in :ref:`publishing_changes`.

--------------------------------------------

**Congratulations! You've finished the exercise-based part of the training. Next up, talk to your trainer about your project and report.**

--------------------------------------------

Bonus: fix a problem you noticed in these documents
===================================================

Sometimes, things in the training documents are out of date by the time the newest hires see them. Other times, certain topics need clarification or a typo needs to be corrected. If you noticed something to improve during the training, you are highly encouraged to make your own edits and propose them through a pull request!

.. admonition:: Exercise: Improve something in these documents
   :class: note

   Find something that needs improvement, make your edits on a new branch, and open a pull request to the training repository.

   (Not sure how to format something? See :ref:`rest_primer`, below.)

Creating an entirely new document
=================================

Simply create a new ``.txt`` file in the ``source/`` directory with the desired name. To have it show up from the homepage, you will also want to make a link to it in ``index.txt`` (for ``foo.txt``, the link would be ``:doc:`foo```), and add it to the "toctree" at the end of that file (again, without the ``.txt`` extension).

.. _publishing_changes:

Publishing changes
==================

This training site is set up using GitHub Pages, a service of GitHub that hosts static web pages for free. The way you add things to GitHub Pages is through a specially named branch called ``gh-pages`` in this repository.

To simplify copying the built HTML pages from one branch to another, there is a target in the Makefile called ``gh-pages``. To use it, make sure you have no uncommitted changes on ``master`` and do::

   $ make gh-pages

That will build the latest copy of the docs, copy them to the ``gh-pages`` branch, commit them, and push them to the origin's ``gh-pages`` branch. Within 5-10 minutes, you should see your changes online at http://josephoenix.github.io/riatraining/.

.. warning::

   If the build fails partway through, you will have to make ``git`` happy again yourself. That means unstaging everything, removing everything but the ``.git`` directory, and running ``git checkout master`` before you can try to build again. (It's kind of a pain, but you shouldn't typically encounter this.)

.. _rest_primer:

Writing with reST
=================

The training documents are formatted in *reST* (reStructuredText). reST is a markup language (like e.g. LaTeX), meaning that there are "source" files and a program that "compiles" them into pages with your formatting applied.

Writing with reST (reStructuredText) is a lot like writing a plain-text email. Bullet points are just asterisks at the beginning of a line, emphasis is accomplished by putting asterisks on either side of a word, and so forth. If you're not sure how some formatting was achieved in these documents, just have a look at the ``.txt`` source file for that document!

Here are some very common patterns for quick reference:

+-----------------------------------+-------------------------------------------------------------+
|Type of formatting                 | Example code                                                |
+===================================+=============================================================+
| Bold                              | |  ``**bold text**``                                        |
+-----------------------------------+-------------------------------------------------------------+
| Italic/emphasis                   | | ``*emphasized text*``                                     |
+-----------------------------------+-------------------------------------------------------------+
| Chapter heading                   | | ``*****************``                                     |
|                                   | | ``Chapter Heading``                                       |
|                                   | | ``*****************``                                     |
+-----------------------------------+-------------------------------------------------------------+
| Section heading                   | | ``Section Heading``                                       |
|                                   | | ``=================``                                     |
+-----------------------------------+-------------------------------------------------------------+
| Link to another training document | | ``:doc:`filename_without_extension```                     |
+-----------------------------------+-------------------------------------------------------------+
| Link to a section heading         | At the heading you want to link to:                         |
|                                   |                                                             |
|                                   | | ``.. _your_reference_name:``                              |
|                                   | |                                                           |
|                                   | | ``Section Heading``                                       |
|                                   | | ``=================``                                     |
|                                   |                                                             |
|                                   | For the link itself:                                        |
|                                   |                                                             |
|                                   | | ``:ref:`link text <your_reference_name>```                |
+-----------------------------------+-------------------------------------------------------------+
| Link to a web page                | | ```text of link <http://example.com/>`_``                 |
+-----------------------------------+-------------------------------------------------------------+

You can also insert an exercise prompt with this code::

   .. admonition:: Exercise: Add a new prompt
      :class: note

      Indent your exercise instructions with three spaces, and
      leave a blank line after the ``admonition`` line but
      before the instructions

Which would look like this:

.. admonition:: Exercise: Add a new prompt
   :class: note

   Indent your exercise instructions with three spaces, and leave a blank line
   after the ``admonition`` line but before the instructions

To include a code listing (e.g. a snippet of python or terminal output), use the ``::`` marker at the end of the preceding paragraph, as in the following example::


   Blah blah preceding paragraph or sentence. Now refer to this code::

      if __name__ == "__main__":
          app = Application()
          app.run()

   Continuing prose description following after a blank line.


Which would look like this:

--------------------------------------------

Blah blah preceding paragraph or sentence. Now refer to this code::

   if __name__ == "__main__":
       app = Application()
       app.run()

Continuing prose description following after a blank line.

--------------------------------------------

For more advanced formatting information, there's a very good `syntax quickstart guide <http://sphinx-doc.org/rest.html>`_ maintained by the Sphinx project.